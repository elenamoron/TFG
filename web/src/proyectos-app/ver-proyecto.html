<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-form/iron-form.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<!--link rel="import" href="../../bower_components/app-layout/app-header-layout"-->
<!--link rel="import" href="../../bower_components/app-layout/app-header"-->
<link rel="import" href="../../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../resumen-app/resumen-app.html">
<link rel="import" href="../juridicas-app/juridicas-app.html">
<link rel="import" href="../representantes-app/representantes-app.html">
<link rel="import" href="../representantes-app/representantes-25capital.html">
<link rel="import" href="../representantes-app/representantes-publica.html">
<link rel="import" href="../representantes-app/representantes-sociedad.html">
<link rel="import" href="../representantes-app/representantes-25control.html">

<dom-module id="ver-proyecto">
    <template>
        <style>
            paper-avatar {
                position: relative;
                height: 90px;
                padding: 2px;
                width: 90px;
                margin: 20px auto;
                margin-left: 80px;
            }
            .avatar-container .image {
                background-size: contain;
                border-radius: 50%;
                height: 100%;
                width: 100%;
            }

            .contact-info {
                margin: 0 20px;
                padding-bottom: 20px;
                border-bottom: 1px solid #CCC;
                text-align: center;
            }
            .contact-info .name {
                font-weight: bold;
            }
            .contact-info .email {
                color: #999;
            }
            paper-item {
                @apply(--layout-center-center);
                height: 54px;
            }
            app-drawer-layout:not([narrow]) [drawer-toggle] {
                display: none;
            }
            app-toolbar {
                /* Toolbar is the main header, so give it some color */
                background-color: #1E88E5;
                font-family: 'Roboto', Helvetica, sans-serif;
                color: white;
            }
            .second {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: normal;
            }
            .avatar {
                display: inline-block;
                box-sizing: border-box;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--paper-amber-500);
            }
            .blue{
                background-color: var(--paper-light-blue-300);
            }
            .red-google {
                background-color: var(--google-red-100);

            }
            .red {
                background-color: var(--paper-red-300);
            }
            .pink {
                background-color: var(--paper-pink-400);
            }
        </style>
        <firebase-auth id="auth" user="{{user}}" provider="google" >
        </firebase-auth>
        <app-location route="{{route}}" use-hash-as-path></app-location>
        <app-route
                route="{{route}}"
                pattern="/proyecto/:page"
                data="{{_pageData}}"
                tail="{{_subRoute}}"></app-route>
        <app-route
                route="{{_subRoute}}"
                pattern="/:id"
                data="{{_idData}}"></app-route>
        <iron-ajax auto
                   id="getProject"
                   url="http://0.0.0.0:8000/api/lpbc/project/{{_pageData.page}}/"
                   handle-as="json"
                   on-response="handleResponse"
                   debounce-duration="300"
                   content-type="application/json"
                   method="GET"
        ></iron-ajax>
        <app-drawer-layout name="resumen" responsive-width="1280px" >
            <app-header-layout>
                <app-header slot="header">
                    <app-toolbar>
                        <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                        <div main-title>[[_pageData.page]]</div>
                        <paper-icon-button icon="settings-power" raised on-click="desconectar"></paper-icon-button>
                    </app-toolbar>
                </app-header>
            </app-header-layout>

            <app-drawer id="drawer" slot="drawer" swipe-open>
                <app-header-layout has-scrolling-region>

                    <app-header fixed>
                        <paper-avatar label="[[user.displayName]]" src="[[user.photoURL]]"></paper-avatar>

                        <div class="contact-info">
                            <div class="name">[[user.displayName]]</div>
                            <div class="email">[[user.email]]</div>

                        </div>
                    </app-header>

                    <paper-listbox
                            selected="{{_pageData.page}}"
                            attr-for-selected="name"
                            on-iron-activate="_drawerSelected">
                        <paper-item name="[[_pageData.page]]/resumen">Resumen
                        </paper-item>
                        <paper-item name="[[_pageData.page]]/juridica">Persona Jurídica</paper-item>
                        <paper-item name="[[_pageData.page]]/representantes">Representantes Autorizados</paper-item>
                        <paper-icon-item name="[[_pageData.page]]/representantes/socios25%">
                            <div class="avatar blue" slot="item-icon"></div>
                            <paper-item-body >
                                <div secondary class="second">Socios que obstentan más del 25% de capital</div>
                            </paper-item-body>
                        </paper-icon-item>
                        <paper-icon-item name="[[_pageData.page]]/representantes/personas-responsabilidad-publica">
                            <div class="avatar" slot="item-icon"></div>
                            <paper-item-body>
                                <div secondary class="second">Personas con responsabilidad pública</div>
                            </paper-item-body>
                        </paper-icon-item>
                        <paper-icon-item name="[[_pageData.page]]/representantes/personas-controlan-sociedad">
                            <div class="avatar red" slot="item-icon"></div>
                            <paper-item-body>
                                <div secondary class="second">Personas que controlan la sociedad</div>
                            </paper-item-body>
                        </paper-icon-item>
                        <paper-icon-item name="[[_pageData.page]]/representantes/25%control">
                            <div class="avatar red-google" slot="item-icon"></div>
                            <paper-item-body>
                                <div secondary class="second">Personas con más del 25% de control</div>
                            </paper-item-body>
                        </paper-icon-item>
                        <paper-icon-item name="[[_pageData.page]]/representantes/negocios">
                            <div class="avatar pink" slot="item-icon"></div>
                            <paper-item-body>
                                <div secondary class="second">Relación de negocios</div>
                            </paper-item-body>
                        </paper-icon-item>
                    </paper-listbox>
                </app-header-layout>

            </app-drawer>
            <iron-pages selected="[[_subRoute.path]]" attr-for-selected="name">
                <resumen-app
                        name="/resumen"
                        route="{{_subRoute}}"
                        proyecto="{{proyecto}}"
                        nombre="{{nombre}}"
                >
                </resumen-app>
                <juridicas-app
                    name="/juridica"
                    route="{{_subRoute}}"
                >

                </juridicas-app>
                <representantes-app
                    name="/representantes"
                    route="{{_subRoute}}"
                >

                </representantes-app>
                <representantes-25capital
                    name="/representantes/socios25%"
                    route="{{_subRoute}}"
                >

                </representantes-25capital>
                <representantes-publica
                    name="/representantes/personas-responsabilidad-publica"
                    route="{{_subRoute}}"
                >

                </representantes-publica>
                <representantes-sociedad
                    name="/representantes/personas-controlan-sociedad"
                    route="{{_subRoute}}"
                >

                </representantes-sociedad>
                <representantes-25control
                    name="/representantes/25%control"
                    route="{{_subRoute}}"
                >

                </representantes-25control>
            </iron-pages>

        </app-drawer-layout>

    </template>
    <script>
        /**
         * @customElement
         * @polymer
         */
        class VerProyecto extends Polymer.Element {
            static get is() { return 'ver-proyecto'; }
            static get properties() {
                return {
                    prop1: {
                        type: String,
                        value: 'ver-proyecto'
                    },
                    user: Object,
                    proyecto: Object,
                    nombre: String

                };
            }
            _drawerSelected() {
                if (!this.$.drawer.persistent) this.$.drawer.close();
            }
            desconectar(){
                this.$.auth.signOut()
                        .then(function(response){
                                    location="#/landing";
                                }

                        )
                        .catch(function(error) {
                            console.log(error);
                        });
            }
            handleResponse (data) {
                if(!this.proyecto.length){
                    this.proyecto = data.detail.response.results;
                    if(this.proyecto[0]){
                        this.nombre = this.proyecto[0].name;
                        if(localStorage.getItem('id_project')){
                            if(localStorage.getItem('id_project')!=this.proyecto[0].id){
                                localStorage.setItem('id_project', this.proyecto[0].id)
                            }
                        }else{
                            localStorage.setItem('id_project', this.proyecto[0].id)
                        }

                    }
                }
            }




        }
        window.customElements.define(VerProyecto.is, VerProyecto);
    </script>
</dom-module>